{% extends "common/internal_page.html" %}
{% load common_extras %}

{% block extrastyle %}
<link rel="stylesheet" href="/media/djdb/djdb.css" />
{% endblock %}

{% block breadcrumbs %}
<a href="/">chipradio home</a>
{% endblock %}

{% block content %}

{% block extrahead %}
<script type="text/javascript" 
    src="/media/common/js/jquery/jquery-1.3.1.js"></script>
<script type="text/javascript" 
    src="/media/common/js/jquery-autocomplete/jquery.autocomplete.js"></script>
<script type="text/javascript" 
    src="/media/djdb/js/djdb.js"></script>
{% endblock %}

Landing page for DJDB app

<p/><p>
<h2>Categories: [
{% for category in categories %}
  {% if not forloop.first %} | {% endif %}
<a href="category/{{ category }}">{{ category|replace:"/_/ "|capfirst }}</a>
{% endfor %}
]</h2>
</o>

<h2>Recent Reviews</h2>
<ul>
{% for rev in recent_reviews %}
  <li> <a href="{{ rev.subject.url }}">{{ rev.subject.title }},</a>
reviewed by {{ rev.author }}
&nbsp;&nbsp;
  <small>Posted {{ rev.timestamp_display|date:"F j, Y P" }}</small> </li>
{% endfor %}
</ul>

<h2>Search the Database</h2>
<form action="" method="post">
  <input type="text" name="query"/>
  <input type="submit" value="Search"/>
  <input type="checkbox" name="reviewed"/>&nbsp;Reviewed
  By
  <input id="id_user" type="text" class="text" name="user"/>
  <input id="id_user_key" type="hidden" name="user_key"/>
</form>
<p/>

{% if query_str %}
<p>Query was "{{ query_str }}".
  {% if invalid_query %}<br/><b>Invalid Query!</b>{% endif %}
</p>

<h3>Artists</h3>
<i>{{ query_results.Artist|length }}
matching artist{{ query_results.Artist|pluralize }}</i><br/>

  {% if query_results.Artist %}
<table>
    {% for artist in query_results.Artist %}
  <tr>
    <td><a href="{{ artist.url}}">{{ artist.pretty_name }}</a></td>
    <td>{{ artist.num_albums }} album{{ artist.num_albums|pluralize }}</td>
  </tr>
    {% endfor %}
</table>
  {% endif %}

<h3>Albums</h3>
<i>{{ query_results.Album|length }}
matching album{{ query_results.Album|pluralize }}</i>
  {% if query_results.Album %}

<p/>
Select: <a id="checkbox_all" href="">All</a>,
        <a id="checkbox_none" href="">None</a>,
        <a id="checkbox_nocat" href="">No category</a>,
  {% for category in categories %}
    {% if not forloop.first %}, {% endif %}
        <a id="checkbox_{{ category }}" href="">{{ category|replace:"/_/ "|capfirst }}</a>
  {% endfor %}<br/>
Mark selected as: <a id="mark_nocat" href="">No category</a>,
  {% for category in categories %}
    {% if not forloop.first %}, {% endif %}
                  <a id="mark_{{ category }}" href="">{{ category|replace:"/_/ "|capfirst }}</a>
  {% endfor %}
<p/>

  {% if query_results.Album %}
<form method="post" name="djdbForm" action="/djdb/album/change_categories">
  <input type="hidden" name="query" value="{{ query_str }}"/>
  <input type="submit" value="Update Categories"/>
  <table>
    {% for album in query_results.Album %}
    <tr>
      <td>
        <input type="checkbox" class="checkbox {{ album.category|lower}}"
               name="checkbox_{{ forloop.counter }}"/>
      </td>
      <td>
        <input type="hidden" name="album_key_{{ forloop.counter }}" value="{{ album.key }}"/>
        <select name="category_{{ forloop.counter }}">
          <option value="none" {% ifequal album.category "none" %}selected="selected"{% endifequal %}>None</option>
      {% for category in categories %}
          <option value="{{ category }}" {% ifequal album.category category %}selected="selected"{% endifequal %}>{{ category|replace:"/_/ "|capfirst }}</option>
      {% endfor %}
        </select>
      </td>
      <td><a href="{{ album.artist_url}}">{{ album.artist_name }}</a></td>
      <td><a href="{{ album.url }}">{{ album.title }}</a></td>
      <td>
      {% if album.num_reviews %}
{{ album.num_reviews }} review{{ album.num_reviews|pluralize }}
      {% endif %}
      </td>
    </tr>
      {% endfor %}
  </table>
    {% endif %}
  <input type="submit" value="Update Categories"/>
</form>
  {% endif %}

<h3>Tracks</h3>
<i>{{ query_results.Track|length }}
matching track{{ query_results.Track|pluralize }}</i>
  {% if query_results.Track %}
<table>
    {% for track in query_results.Track %}
  <tr>
    <td>{{ track.title }}</td>
    <td><a href="{{ track.artist_url }}">{{ track.artist_name }}</a></td>
    <td><a href="{{ track.album.url }}">{{ track.album.title }}</a></td>
    {% endfor %}
  </tr>
</table>
  {% endif %}
{% endif %}

{% endblock %}
